package com.github.berry120.adventofcode_2021;

import lombok.AllArgsConstructor;
import lombok.ToString;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.stream.Collectors;

@AllArgsConstructor
public class Day4 {

  List<Integer> calledNumbers;
  List<Board> boards;

  public Day4(String input) {
    String firstLine =  "23,91,18,32,73,14,20,4,10,55,40,29,13,25,48,65,2,80,22,16,93,85,66,21,9,36,47,72,88,58,5,42,53,69,52,8,54,63,76,12,6,99,35,95,82,49,41,17,62,34,51,77,94,7,28,71,92,74,46,79,26,19,97,86,87,37,57,64,1,30,11,96,70,44,83,0,56,90,59,78,61,98,89,43,3,84,67,38,68,27,81,39,15,50,60,24,45,75,33,31";
    String text =
         "67 97 50 51  1\n"
            + "47 15 77 31 66\n"
            + "24 14 55 70 52\n"
            + "76 46 19 32 73\n"
            + "34 22 54 75 17\n"
            + "\n"
            + "44 11 97 50 71\n"
            + "66  7 24  9 67\n"
            + "88 39 82 93 57\n"
            + "77  5  6 58 51\n"
            + "85 61 65 70 23\n"
            + "\n"
            + "72 74 58 71 41\n"
            + " 4 57 45 89 67\n"
            + "78 55 66 28 48\n"
            + "82 61 87 85 84\n"
            + "96  8 94 76 97\n"
            + "\n"
            + "25 33 45 16 68\n"
            + "60 27 22 13 29\n"
            + "92 95 93 50 36\n"
            + "43  1 66 51 99\n"
            + "85 14 20 52 58\n"
            + "\n"
            + "65 47 18 50 90\n"
            + "44 25 11 70 81\n"
            + "86 36 45 10 85\n"
            + "43 89 74  0 14\n"
            + "97 59 32 91  5\n"
            + "\n"
            + "64 19 39 69 90\n"
            + "41  5 59 37 42\n"
            + "75 95 58 89 92\n"
            + "20  3 85 48 71\n"
            + "31 94 11 18 70\n"
            + "\n"
            + "30 17 56 54 79\n"
            + "63 12 51 57  5\n"
            + "95 16 98 75 69\n"
            + "80 87 71 39 48\n"
            + "66 14 99 42 31\n"
            + "\n"
            + "27 35 46 69 50\n"
            + " 3 16 84 39 42\n"
            + "19 22 34 80 72\n"
            + "40 54 66 30 10\n"
            + "12 67 36  9 74\n"
            + "\n"
            + "39 47 61  3 35\n"
            + "15 33 45 79 58\n"
            + "96 53 20 80 19\n"
            + "75 85 73  6 64\n"
            + "43 88 72 69 37\n"
            + "\n"
            + "52 68 12 23 59\n"
            + "79 32 37 87 69\n"
            + "48 31  4 36 51\n"
            + "77  2 92 67  8\n"
            + "13 88 93 98 20\n"
            + "\n"
            + "12 54 34 13 27\n"
            + "79 85 62 76 71\n"
            + "52 84 65 93 66\n"
            + "40 89 73 95 74\n"
            + "29 70 32 11 41\n"
            + "\n"
            + "54 56 53 55 78\n"
            + "21 85 43 75 79\n"
            + "62 66 14 84  2\n"
            + "32 13 83 38  7\n"
            + "15 71 81 63 49\n"
            + "\n"
            + "83  7 51 49 50\n"
            + "89 59  9 72 80\n"
            + "99 41 65 13 64\n"
            + "74 95 75 54 90\n"
            + "53 79 58 40  5\n"
            + "\n"
            + "36 16 46 71 87\n"
            + "73 13 84  3 38\n"
            + "69 88 85 28 68\n"
            + "63 94  0 86  1\n"
            + "49 44 65 39 15\n"
            + "\n"
            + "55 27 91 44 39\n"
            + " 6 75 14 22 99\n"
            + "38 89 92 42 11\n"
            + "20 60  3 70 15\n"
            + " 5 19 78 88 81\n"
            + "\n"
            + "16 90 29 52 86\n"
            + "60 61 96 47 91\n"
            + "19 59 10 14  4\n"
            + "18 35 50 20 25\n"
            + "56  2 99 63 72\n"
            + "\n"
            + "66 54 87  7 98\n"
            + "55 45 62 38 99\n"
            + "13 23 76 30  3\n"
            + "75 68  5 51 46\n"
            + " 0 60 71 70 41\n"
            + "\n"
            + "22 77 65 72 27\n"
            + "88  9 25 44  0\n"
            + "61  6 46 41 26\n"
            + "74 78 20 86 87\n"
            + "70 81  4  5 48\n"
            + "\n"
            + "41 51  8 64 50\n"
            + "96 40 45 85 53\n"
            + "18 86 24 29 27\n"
            + "90 11 39 82 88\n"
            + "12 56 54 87 59\n"
            + "\n"
            + "90 79 64 77 78\n"
            + "97 12 72 27 86\n"
            + "32 56 33 18 46\n"
            + "95  5 51  6 80\n"
            + "34 38 42 35 52\n"
            + "\n"
            + "66 10 82 90 19\n"
            + "38 69 71 77 72\n"
            + "61  9 98 86 93\n"
            + "56  7 88 28 47\n"
            + "22 96 21 52 64\n"
            + "\n"
            + "91 82 25 93 69\n"
            + "95 79 84 35 90\n"
            + "48  0 28 41 83\n"
            + "23 55 88 71 65\n"
            + "97 19 67 31 59\n"
            + "\n"
            + "47 60 65 11 85\n"
            + "97 36 64 96 70\n"
            + "82 84 76 89 44\n"
            + "67 26 28 21 41\n"
            + "63 54 94 10 34\n"
            + "\n"
            + "24 19 78  4 69\n"
            + "52 38  7 58 21\n"
            + "20 23 10 91 42\n"
            + "44 36 25 45 49\n"
            + "94 51 98 99 27\n"
            + "\n"
            + "67 25 54 28 71\n"
            + " 9 14 89 91 46\n"
            + "65  1 55 88 19\n"
            + "59 45 26 84 73\n"
            + "83 62 50 42 97\n"
            + "\n"
            + "58 51 29 60 94\n"
            + "34 79 39 19 91\n"
            + " 9 81 93 35 70\n"
            + " 4 23 80 33 75\n"
            + "73 69  7 49 59\n"
            + "\n"
            + "44 83 20 24 56\n"
            + "41 50 77 55 10\n"
            + "79 49 67 99 16\n"
            + "36 57 33 15 98\n"
            + "40 76  4 53 39\n"
            + "\n"
            + "59 92 67  6 80\n"
            + "64 90 15 40  7\n"
            + "36 96 62 25 32\n"
            + "44 91 52 43 19\n"
            + " 5  2 51 88 87\n"
            + "\n"
            + " 4 97 70 78 59\n"
            + "90 43 62 50 41\n"
            + "61 64  2 91 49\n"
            + "19 82 85 30 73\n"
            + "15 51 36 11 34\n"
            + "\n"
            + "97  7 86 64 40\n"
            + "15 46 84  0 58\n"
            + "54 87 73 93 20\n"
            + "48 94 32  4 77\n"
            + "13 85 72 50 36\n"
            + "\n"
            + "68 54 94 71 83\n"
            + "81 53 33 12 58\n"
            + "22 67 52 21 25\n"
            + "79 90 59 92 41\n"
            + "29 11 76 98 85\n"
            + "\n"
            + "10 25 64  3 83\n"
            + "21 87 97 78  7\n"
            + "44 71 48 22 74\n"
            + "80 72 90 29 63\n"
            + " 1 24 32 84 13\n"
            + "\n"
            + "25 28 19 65 24\n"
            + "98 32  4  6 99\n"
            + " 7  0 27 37 35\n"
            + "72 11  1 76 73\n"
            + "49 85 83 93 14\n"
            + "\n"
            + "78 91 50 45 29\n"
            + "35 27 18 48 87\n"
            + " 3 56 60 99 64\n"
            + "84 61 15 77 40\n"
            + "58 39 19  0 92\n"
            + "\n"
            + "98 38 88 43 39\n"
            + "48 93  4 52 66\n"
            + "57 99 83 55 25\n"
            + "91 35 42 12 23\n"
            + "40 15 81 94 77\n"
            + "\n"
            + "85 28 95 76 78\n"
            + "39 66 18 47 49\n"
            + "32 77 34 12 58\n"
            + "69 15 45  6 41\n"
            + " 3 51 25 40 63\n"
            + "\n"
            + "58 97 10  5 57\n"
            + "47 86 24 78 98\n"
            + "89 25 39 73 83\n"
            + "11 15 99 68 66\n"
            + "84 70 61 76 30\n"
            + "\n"
            + "67 40 29 75 90\n"
            + "71 31 41 37 52\n"
            + "61  0 86 84 94\n"
            + "25 96  9 21  6\n"
            + "39 62 14  1 81\n"
            + "\n"
            + "15 65 47 63 94\n"
            + "82 21 32 38 67\n"
            + "12 20 30 91 68\n"
            + "16 79  4 28 45\n"
            + " 1 70 84 49 78\n"
            + "\n"
            + "80 21 39 92 71\n"
            + "48  8 87  0 38\n"
            + "74  4 52 23 98\n"
            + "53 89 61 30 46\n"
            + "29 10 64 49  5\n"
            + "\n"
            + "40  2 62 39 51\n"
            + " 4 24 19 73 75\n"
            + "86 14 97 91 11\n"
            + "43  7 77 71 28\n"
            + "32 63  6 20  8\n"
            + "\n"
            + "90 57 28 47 23\n"
            + "10 41 77 52 31\n"
            + "45 18 55 80 49\n"
            + "76 50 16 96 81\n"
            + "91 75 93 68 58\n"
            + "\n"
            + "63 87 12 16 60\n"
            + "36 52 94 39 91\n"
            + "67 56 24 18 26\n"
            + "73 80 46  1 84\n"
            + "30 74  6 61 75\n"
            + "\n"
            + "98 32 56 51 44\n"
            + "58 78 71 74 26\n"
            + "55 45 83 10 30\n"
            + "54 47 93 62 23\n"
            + "15 67 53 21 49\n"
            + "\n"
            + "59 93 49 65 42\n"
            + " 9 74 58 52 18\n"
            + " 1 47 71 25 68\n"
            + "45 92 67 60 73\n"
            + "97 63 61 34 36\n"
            + "\n"
            + "73 74  6 68 40\n"
            + "76 85  1 26 91\n"
            + "90 94 39 92 17\n"
            + "80 51 20 77 67\n"
            + "54 88 21 57 83\n"
            + "\n"
            + "14 52 70 30 32\n"
            + "60 69 75 10 24\n"
            + "65 40 72 71 58\n"
            + "80 73 84 96  4\n"
            + "62  9 28 41 36\n"
            + "\n"
            + "56  2 83  9 50\n"
            + "75 42  5  3 72\n"
            + "73 28 34 76 38\n"
            + "49 33 30 80 46\n"
            + "37 77 55 45 74\n"
            + "\n"
            + "40 69 31 88  8\n"
            + "58 27 78 26 95\n"
            + "73 86  1 34 79\n"
            + "12 83  2 75 92\n"
            + " 0 48 63 17 65\n"
            + "\n"
            + " 3 87 59 76 24\n"
            + "90 10 44 28 21\n"
            + "83 19 77 86 51\n"
            + "81 88 42 94 15\n"
            + "27 78 92 34 30\n"
            + "\n"
            + "44 23 83 22 87\n"
            + "75 53 91 93 89\n"
            + "88 40 56 46 37\n"
            + " 0  4 80 24  7\n"
            + "97 72 96 12 68\n"
            + "\n"
            + "40 45 61 84 31\n"
            + "85 12 27 82 50\n"
            + " 4 49 33  6 44\n"
            + "51 36 15  0 14\n"
            + "68 77 64 11 79\n"
            + "\n"
            + "31 79 50 63 59\n"
            + "13  4  6 54  7\n"
            + "86 30 41 68 34\n"
            + "16 35 48 11 70\n"
            + "84  8 81 65 74\n"
            + "\n"
            + "75 33 21 60 57\n"
            + " 7 86 82 18 68\n"
            + "40 91  0 28 38\n"
            + "90 36 92 94 55\n"
            + "95 88 85 62 25\n"
            + "\n"
            + " 7  5 75 36 74\n"
            + "40 37 58 92 93\n"
            + "46 68 24 98 34\n"
            + "32 88 67 62 53\n"
            + "83 84 90 31 63\n"
            + "\n"
            + "17 24 25 93 37\n"
            + "16 36 59 81 41\n"
            + "99 51 12 77 98\n"
            + "80 32 28 18 39\n"
            + "44 85 38 64 73\n"
            + "\n"
            + "83 18 86 33 61\n"
            + "21 88 94 62 67\n"
            + "40 25 97 27 73\n"
            + "71 90 63 87  6\n"
            + "16  7 36 92 69\n"
            + "\n"
            + "69 67 35 24 84\n"
            + "79 44 66 37 75\n"
            + " 0 73 53 80 15\n"
            + "74 20 32 12 60\n"
            + "36 22 29 85 82\n"
            + "\n"
            + "49 72 69 33 10\n"
            + "45 81 43  0 22\n"
            + "12 76  5 29 52\n"
            + "82 40 42 63 85\n"
            + " 1 34 32 66 15\n"
            + "\n"
            + "82 41 16 67 23\n"
            + "30 84 25 88 48\n"
            + "75 71 43  0  2\n"
            + "35  3 68 26 50\n"
            + "64 24  8 89 98\n"
            + "\n"
            + "61 23 63 51 46\n"
            + "21 59 99 97 91\n"
            + "60 34 42 26 31\n"
            + "12 64 38 96 24\n"
            + " 5 13 90 37 94\n"
            + "\n"
            + "97  0 20 61 96\n"
            + "92 39 43 57 64\n"
            + "87 52 16 85 45\n"
            + "60 41 86  6 53\n"
            + "75 10 24 21 37\n"
            + "\n"
            + "37 92  1 46 51\n"
            + "33  5 88 47 19\n"
            + " 0 35  2 69 72\n"
            + "67 56 49 20 63\n"
            + "25  7 41 65 91\n"
            + "\n"
            + "17 69 67 77 23\n"
            + "16 79 81 51 57\n"
            + "12 59 49 76 91\n"
            + " 1 55 41 87 38\n"
            + "85 98 37 71  5\n"
            + "\n"
            + "90 11 18 59 31\n"
            + "61  1 28  2 27\n"
            + "98 56 95 63 93\n"
            + "24 83 36 85 72\n"
            + "64 97 69 20 10\n"
            + "\n"
            + "80 58 95  5 74\n"
            + " 6 20 13 59 63\n"
            + " 8 62 55 53 41\n"
            + "48 70 28 10 47\n"
            + "18  4 76 45 34\n"
            + "\n"
            + "39 30 64 24 14\n"
            + "42  6  0 33 57\n"
            + "35  7 68 62 32\n"
            + "70 65 44 82 31\n"
            + "98 93 50 53 61\n"
            + "\n"
            + "14  9 98 70 45\n"
            + "27 86  6 21 76\n"
            + "56 19 26 28 43\n"
            + "78 87 58 89 97\n"
            + "72 49 54 67  8\n"
            + "\n"
            + "21 22 51 62 59\n"
            + "38 64 30 40 94\n"
            + "56 57 28 19 17\n"
            + "50 32 83 97 48\n"
            + "41 54 75 66  5\n"
            + "\n"
            + " 4 21 16 91 75\n"
            + "17 87 68 38 66\n"
            + "92 11 39 31 45\n"
            + "58 41 96 85 98\n"
            + "99 44 86 15 26\n"
            + "\n"
            + "76 61 82 96 49\n"
            + "98 10 93 22 56\n"
            + "66 78 21 73 67\n"
            + " 3 39 15 85 87\n"
            + "48 91 45 70 53\n"
            + "\n"
            + "17  6  8 46 30\n"
            + "81 53 76 21 63\n"
            + "20 47 75 67 59\n"
            + "69 58  5 62 92\n"
            + " 7  9 93 43 70\n"
            + "\n"
            + "17 50 24 71 28\n"
            + "30 31 37 48 80\n"
            + "34 62 19 57 41\n"
            + "88 49 51 93 98\n"
            + "87 78 55 94 46\n"
            + "\n"
            + "93 87 54 64 29\n"
            + "81 66 35 43 25\n"
            + "74 86 95  2 92\n"
            + "42 94 45 51 17\n"
            + "23 28 16 37 80\n"
            + "\n"
            + "68 15 25 10 32\n"
            + "60 51 45 38  4\n"
            + "64 47 50 12 14\n"
            + "86 61 31 67  2\n"
            + "18 28 55 59 87\n"
            + "\n"
            + "95 84 19 48  0\n"
            + "12 22 97  6 89\n"
            + "93 70 71 35 88\n"
            + "49 18 37 58 36\n"
            + "43 63 23 68 17\n"
            + "\n"
            + "29 15 91 37 45\n"
            + " 3 98 33 73 39\n"
            + "31 13 94 90 96\n"
            + "81 87 78 93 42\n"
            + "69 75 14  2 27\n"
            + "\n"
            + "80 30 69 34  1\n"
            + "59 23 20 85 31\n"
            + "48 71 16 96 92\n"
            + "66 99 39 53 52\n"
            + "91 67 70 77 19\n"
            + "\n"
            + "90 16 52 74  2\n"
            + "41 39 95 59  1\n"
            + "46 84 64 93 14\n"
            + "92 48 25 28 98\n"
            + "94 81 20 27 32\n"
            + "\n"
            + "22 89 48 77 37\n"
            + "54 59 30 71 38\n"
            + "80 53  3 27 32\n"
            + "25 23 35 79 91\n"
            + "15 29  7 93  9\n"
            + "\n"
            + "60 38 37  5 96\n"
            + "51 77 28 63 80\n"
            + "45 67 87 20 34\n"
            + "56 26 61 85 82\n"
            + "19 71 27 41 54\n"
            + "\n"
            + "27 71 18 16 40\n"
            + "88  3 61 74 52\n"
            + "80 44 34 10 36\n"
            + "15  2  1  4 11\n"
            + "84 50 72 39 89\n"
            + "\n"
            + "42 74 45  1 35\n"
            + " 0 63 38 12 85\n"
            + "18  2 13 87 30\n"
            + "44 67 68 41 70\n"
            + "47 82 98 48 69\n"
            + "\n"
            + "34 78 38 27  9\n"
            + "91 47 69 51 73\n"
            + "67 59 45 15 21\n"
            + "30 24 89  5  2\n"
            + "36 22 87 68 76\n"
            + "\n"
            + "18 68 58 95 29\n"
            + "72 24 70 47 79\n"
            + "35 63 20 71 93\n"
            + "60 59 34 49 81\n"
            + "22 98 57 53 76\n"
            + "\n"
            + "46 40 82 45  0\n"
            + " 2 22 28 38 97\n"
            + "11 16 78 95 86\n"
            + "80 85 83 17 67\n"
            + "63  1 26 25 64\n"
            + "\n"
            + "49 81 31  9 60\n"
            + "33 15 29 38 66\n"
            + "90 43  2 39 89\n"
            + "24 40 63 36 91\n"
            + "45 68 62 87 12\n"
            + "\n"
            + "36 54 76 33  9\n"
            + "60  7 25 96 61\n"
            + "17  4  1 62 31\n"
            + "93 83 79 30 73\n"
            + "88 75 13  6 24\n"
            + "\n"
            + "47 96  5 82 34\n"
            + "76 67 30 15  2\n"
            + "52 43 16 92 77\n"
            + "58 13 18 78 84\n"
            + "39 41 74 46 91\n"
            + "\n"
            + "15 45 99 42  5\n"
            + "41 61 58 14 55\n"
            + "24 76 46 91 78\n"
            + "52 56 81 92 59\n"
            + " 4  0 63 95 29\n"
            + "\n"
            + "75 53  8 76 33\n"
            + "82 60  7 32 97\n"
            + "90 40 56 51  1\n"
            + "15 48  4 41 71\n"
            + "13 69 46 65 52\n"
            + "\n"
            + "77 93 27 42 20\n"
            + " 0 68 31 51 52\n"
            + " 3 83 56  4 38\n"
            + "54 65 86 72 16\n"
            + "35 34  2 99 64\n"
            + "\n"
            + " 0 47 54 49 73\n"
            + "11 61 18 69 16\n"
            + "75 90  3 65 93\n"
            + "22 57 84 96  8\n"
            + "92  4  5  2 35\n"
            + "\n"
            + "91 23 41 85 88\n"
            + "68 28  9 70 74\n"
            + "51 71 42 79  7\n"
            + "61 77 57 82 18\n"
            + "16  4 32 80 38\n"
            + "\n"
            + "99 87 92 63 24\n"
            + "51 64 22  9 94\n"
            + "48  5  7 83 19\n"
            + "11 27 46  2 17\n"
            + "33 60 36 30 32\n"
            + "\n"
            + "91 20 80 10 81\n"
            + "55 78  8 67  7\n"
            + "37 76 31 16 49\n"
            + "30 33 63 68 28\n"
            + "50 35 40 74 77\n"
            + "\n"
            + "27 39 23 34 94\n"
            + "51 18 60  8 98\n"
            + "28 75  4 85 12\n"
            + "96  2 15 29 88\n"
            + "46 35 32 79 50\n"
            + "\n"
            + "91 62  4 40 11\n"
            + "92 47 56  5  3\n"
            + "85 75 55  8 12\n"
            + "25 48 13 31 21\n"
            + "46 54 95 26 80\n"
            + "\n"
            + " 5 54 87 34  3\n"
            + "96 12 67  6 14\n"
            + " 1 43 92 35 49\n"
            + "31 72 65 85  2\n"
            + "75 81 26 28  4\n"
            + "\n"
            + "81 38  3 64 71\n"
            + "69 53 19  1 67\n"
            + "17 63 73 10 85\n"
            + "37 15 91 20 62\n"
            + " 0 35 47  8 43";
    calledNumbers = Arrays.stream(firstLine.split(",")).map(Integer::parseInt).collect(Collectors.toList());
    boards = Arrays.stream(text.split("\n\n")).map(Board::fromStr).collect(Collectors.toList());
  }

  public int part1() {
    int lastScore=-1;
    for(int called : calledNumbers) {
      List<Integer> wonIdx = new ArrayList<>();
      for(int i=0  ; i<boards.size() ; i++) {
        Board board = boards.get(i);
        int ret = board.test(called);
        if(ret!=-1) {
          wonIdx.add(i);
          lastScore = ret;
//          return ret;
        }
      }
      for(int i=boards.size()-1 ; i>=0; i--) {
        if(wonIdx.contains(i)) {
          boards.remove(i);
        }
      }
    }
    return lastScore;
  }

  public int part2() {
    return 0;
  }

  @AllArgsConstructor
  @ToString
  static class Board {
    List<List<Integer>> nums;

    int test(int num) {
      for(List<Integer> row : nums) {
        int idx = row.indexOf(num);
        while(idx!=-1) {
          row.set(idx,-1);
          idx = row.indexOf(num);
        }

      }

      for(int i=0 ; i<5 ; i++) {
        boolean allGoodR = true;
        boolean allGoodC = true;
        for(int j=0 ; j<5 ; j++) {
          if(nums.get(i).get(j)!=-1) allGoodR=false;
          if(nums.get(j).get(i)!=-1) allGoodC=false;
        }
        if(allGoodC||allGoodR) {
          return score(num);
        }
      }
      return -1;
    }

    int score(int num) {
      return nums.stream()
              .flatMap(r -> r.stream().filter(x->x!=-1))
              .mapToInt(Integer::intValue)
              .sum() * num;
    }

    static Board fromStr(String str) {
      List<List<Integer>> nums = new ArrayList<>();
      for(String line: str.split("\n")) {
        List<Integer> row = new ArrayList<>();
        for(String num : line.split("\\s+")) {
          if(num.isBlank()) continue;
          row.add(Integer.parseInt(num));
        }
        nums.add(row);
      }
      return new Board(nums);
    }
  }

}
